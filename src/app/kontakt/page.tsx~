'use client'

import { useState } from 'react'
import { sanityClient } from '@/sanity/client'

export default async function Kontakt() {
  // Fetch site info from Sanity
  const site = await sanityClient.fetch(`*[_type == "siteSettings"][0]{
    contact { phone, email, address, serviceArea }
  }`)

  return (
    <main className="max-w-3xl mx-auto p-6">
      <h1 className="text-3xl font-bold mb-6 text-center">Kontakt</h1>

      <section className="mb-10 text-center">
        <p className="mb-2">
          <strong>Telefon:</strong> {site?.contact?.phone}
        </p>
        <p className="mb-2">
          <strong>E-post:</strong>{' '}
          <a href={`mailto:${site?.contact?.email}`} className="text-blue-700 underline">
            {site?.contact?.email}
          </a>
        </p>
        <p className="mb-2">
          <strong>Adresse:</strong> {site?.contact?.address}
        </p>
        <p>
          <strong>Område:</strong> {site?.contact?.serviceArea}
        </p>
      </section>

      <ContactForm />
    </main>
  )
}

/**
 * Simple contact form component using Formspree
 */
function ContactForm() {
  const [status, setStatus] = useState<'idle' | 'sending' | 'sent' | 'error'>('idle')

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault()
    setStatus('sending')

    const form = e.currentTarget
    const data = new FormData(form)
    const response = await fetch('https://formspree.io/f/xqaygbdq', {
      method: 'POST',
      body: data,
      headers: { Accept: 'application/json' },
    })

    if (response.ok) {
      setStatus('sent')
      form.reset()
    } else {
      setStatus('error')
    }
  }

  return (
    <form onSubmit={handleSubmit} className="max-w-md mx-auto bg-gray-50 p-6 rounded-lg shadow">
      <label className="block mb-4">
        <span className="block font-medium mb-1">Namn</span>
        <input
          type="text"
          name="name"
          required
          className="w-full border rounded px-3 py-2"
          placeholder="Ditt namn"
        />
      </label>

      <label className="block mb-4">
        <span className="block font-medium mb-1">E-post</span>
        <input
          type="email"
          name="email"
          required
          className="w-full border rounded px-3 py-2"
          placeholder="din@epost.no"
        />
      </label>

      <label className="block mb-4">
        <span className="block font-medium mb-1">Melding</span>
        <textarea
          name="message"
          rows={5}
          required
          className="w-full border rounded px-3 py-2"
          placeholder="Skriv meldinga di her..."
        />
      </label>

      <button
        type="submit"
        disabled={status === 'sending'}
        className="w-full bg-teal-700 text-white py-2 rounded-md hover:bg-teal-800"
      >
        {status === 'sending' ? 'Sender…' : 'Send melding'}
      </button>

      {status === 'sent' && <p className="mt-4 text-green-700">Takk for meldinga di!</p>}
      {status === 'error' && <p className="mt-4 text-red-700">Noko gjekk gale. Prøv igjen.</p>}
    </form>
  )
}

